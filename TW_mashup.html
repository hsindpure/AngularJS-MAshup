<!doctype html>
<html qva-bootstrap="false">
<head>
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Sufee Admin - HTML5 Admin Template</title>
    <meta name="description" content="Sufee Admin - HTML5 Admin Template">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="apple-touch-icon" href="apple-icon.png">
    <link rel="shortcut icon" href="favicon.ico">

<script src="jquery.min.js"></script>
    <script src="bootstrap.min.js"></script>
    <script src="main.js"></script>

    <link rel="stylesheet" href="bootstrap.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">



    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800' rel='stylesheet' type='text/css'>
	
	  <link rel="stylesheet" href="../../resources/autogenerated/qlikui.css">	
  <link rel="stylesheet" href="../../resources/autogenerated/qlik-styles.css">
  <link rel="stylesheet" href="client.css">
	<script src="../../resources/assets/external/requirejs/require.js"></script>
		<link rel="stylesheet" href="style.css">
	<link rel="stylesheet" href="TW_mashup.css">
	
	<script src="TW_mashup.js"></script>
</head>
<body style="overflow: auto">

    <!-- Left Panel -->

    <aside id="left-panel" class="left-panel">
        <nav class="navbar navbar-expand-sm navbar-default">

            <div class="navbar-header">
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-menu" aria-controls="main-menu" aria-expanded="false" aria-label="Toggle navigation">
                    <i class="fa fa-bars"></i>
                </button>
                <a class="navbar-brand" href="./">Logo</a>
                <a class="navbar-brand hidden" href="./"><img src="logo.png" alt="Logo"></a>
            </div>

            <div id="main-menu" class="main-menu collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li class="active">
                        <a href="#!Executive_TW_Business"> <i class="menu-icon fa fa-dashboard"></i>Dashboard </a>
                    </li>
                    <h3 class="menu-title">Sheets</h3><!-- /.menu-title -->
                    <li class="menu-item-has-children">
                        <a href="#!Executive_TW_Business" > <i class="menu-icon fa fa-laptop"></i>Executive TW Business</a>
                       
                    </li>
                    <li class="menu-item-has-children">
                        <a href="#!Digital_TW_Business_MIS" > <i class="menu-icon fa fa-table"></i>Digital TW Business MIS</a>
                       
                    </li>
                    <li class="menu-item-has-children dropdown">
                        <a href="#!Manufacture_Analysis"> <i class="menu-icon fa fa-th"></i>Manufacture Analysis</a>
                        
                    </li>

                   
                    
                </ul>
            </div><!-- /.navbar-collapse -->
        </nav>
    </aside><!-- /#left-panel -->

    <!-- Left Panel -->

    <!-- Right Panel -->

    <div id="right-panel" class="right-panel">
	
	<header id="header" class="header">

            <div class="header-menu">

                <div class="col-sm-12" style="display: flex;align-items: center;">
                    <a id="menuToggle" class="menutoggle pull-left"><i class="fa fa fa-tasks"></i></a>
                    <div class="header-left">
                        
						<h4>
						TW Business MIS-Offsite
						</h4>
                      

                    </div>
					
					<div class="header-right" style="display:flex;    margin-left: auto;gap: 30px;">
						
						<div style="display: flex; align-items: flex-end;">
							<h2 id="title">
							
							</h2>
						</div>
                      <div >
					 <a id="curr_Selections">Current Selection<span id="selectionsnotification"></span></a>
					 
					 <div class="container-selection"> 
						  <div class="items">
							<div class="items-head">
							  <p class="clear">Clear All</p>
							  <hr>
							</div>

							<div id="selections">
							 
							</div>
						  </div>
						</div>

                    </div>
					
						<div class="">
							 <a id="nav-toggle"><i class=" menu-icon fa fa-filter"></i></a>
								<div class="menu">
							  <!-- Menu -->
							 <div class="filter_container" id="qfilter">

							 </div>
							</div>

						</div>
					
                </div>


                </div>
			
            </div>
			
			<script>
			
			</script>

        </header><!-- /header -->
		<div ng-view>

		</div>

    </div><!-- /#right-panel -->
	
	









   <script>
   
   /*
 *    Fill in host and port for Qlik engine
 */
 
 
 $("#curr_Selections").click(function(e){
 
   e.stopPropagation();
 $(".container-selection").toggleClass('selContainer');
 });
 
 
 
 			$('#nav-toggle').click(function(e) {
			  e.stopPropagation();
			  $(".menu").toggleClass('bar')
			});
			
			$('body').click(function(e) {
			  if ($('.menu').hasClass('bar')) {
				$(".menu").toggleClass('bar')
			  }
			  
			  $(".menu").click(function(e) {
			  e.stopPropagation();
			  });
			  
			 if($(".container-selection").hasClass('selContainer')){
			 $(".container-selection").toggleClass('selContainer');
			 }
			});
 
 
 
var prefix = window.location.pathname.substr( 0, window.location.pathname.toLowerCase().lastIndexOf( "/extensions" ) + 1 );

var config = {
	host: window.location.hostname,
	prefix: prefix,
	port: window.location.port,
	isSecure: window.location.protocol === "https:"
};
//to avoid errors in workbench: you can remove this when you have added an app
var app;
require.config({
	baseUrl: (config.isSecure ? "https://" : "http://" ) + config.host + (config.port ? ":" + config.port : "" ) + config.prefix + "resources"
});


//require( ["js/qlik", "./qBlob.js"], function ( qlik, qBlob )  {
require( ["js/qlik"], function ( qlik )  {
	window.qlik = qlik;
	
	qlik.theme.apply('power bi').then(function(result){


});



	qlik.setOnError( function (error) {
		console.log(error);
	});
	
	$('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
		qlik.resize();
	});
	

		var app = qlik.openApp( "Consumer Sales.qvf", config );
   //var app= qlik.openApp( "01e3af1a-3031-4f17-a7b3-ae1388a1aff0", config );
  // var app = qlik.openApp( "ddaefb3c-66a4-4d49-ade7-048cc43025f5", config );
	
	
			//replace( /T/, ' ' ).replace( /Z/, ' ' )    "+strTime
	
	var global = qlik.getGlobal();

    global.getAuthenticatedUser(function (reply) {

        console.log("reply",reply);

        console.log('User:', reply.qReturn);

    });
			app.getObject('qfilter','PewkLk');
			//app.getObject('refresh','XsPpM');
		 app.getList("SelectionObject", function(reply) {

        $("#selectionsnotification").hide();
        $selections = $("#selections"); //DOM node to append selections to
        $selections.html(""); //Clear node of any previous selections
        var fields = []; //Empty Array
        var fieldssel = 0; //initialize variable

       /* if (reply.qSelectionObject.qSelections.length === 0) {
            $("#selections").css("visibility", "hidden");
        } else {
            $("#selections").css("visibility", "visible");
        }*/



        //Loop through array of fields that have selections
        $.each(reply.qSelectionObject.qSelections, function(key, value) {

            var field = value.qField; //The field name
            var numSelected = value.qSelectedCount; //Number of selections in field
            var total = value.qTotal; //Total number of values in field
            var threshold = value.qSelectionThreshold - 4; //Threshold in which to display a number count instead of each value
            var selectedStr = value.qSelected; //When numSelected is less than or equal to threshold, a string of the names of each value selected

            fields.push(field);
            var fieldssel = fields.length;
            $("#selectionsnotification").html(fieldssel);
            $("#selectionsnotification").show();


            var array = selectedStr.split(",");





							  
							  

            //If numSelected is below or equal to threshold, show string of names of each value selected
            if (numSelected <= threshold) {

                var html = "";

                html += "<div class='items-body-content' id='" + field + "'>";
               
			   var div = "";
			   div += "<div class='selList' >";
                
				
                

                $.each(array, function(i) {
                    console.log(array[i]);
                    div += ' <span class="label label-sm label-icon label-warning selectedelements"> ' + array[i] + ' </span> ';
                });
				
				div += '<span class="details "> ' + field + ' </span> </div>';
				
				html += div;
				
		
				
				 html += "<a href='javascript:;' class='clear-field'>";
                html += ' <span class="time"><i class="fa fa-close"></i></span>';


                $selections.append(html);
            }

            // If numSelected is greater than threshold, show the numSelected of total values
            else {

                var html = "";
              	 html += "<div class='items-body-content' id='" + field + "'>";
     			
				var div = "";
				div += "<div class='selList' >";
                
				
               
                div += ' <span class="label label-sm label-icon label-warning selectedelements">&nbsp;' + numSelected + ' of ' + total + ' &nbsp; </span>';
				 div += '<span class="details "> ' + field + ' </span>  </div>';
				html += div;
				
				html += "<a href='javascript:;' class='clear-field'>";
                html += ' <span class="time"><i class="fa fa-close"></i></span>';

                $selections.append(html);
            }

        });
		
		$(".clear-field").click(function() {
            //console.log($(this).parent().attr("id"));
            var field = $(this).parent().attr("id");
            app.field(field).clear();
        });

    });
	
	
	$(".clear").click(function(){
		app.clearAll();
	});
	
	
	
	
	
	
	
	
	$( "[data-qcmd]" ).on( 'click', function () {
			var $element = $( this );
			switch ( $element.data( 'qcmd' ) ) {
				//app level commands
				case 'clearAll':
					app.clearAll();
					break;
				case 'back':
					app.back();
					break;
				case 'forward':
					app.forward();
					break;
				case 'lockAll':
					app.lockAll();
					break;
				case 'unlockAll':
					app.unlockAll();
					break;
				case 'createBm':
					var title = $( "#bmtitle" ).val(), desc = $( "#bmdesc" ).val();
					app.bookmark.create( title, desc );
					$( '#createBmModal' ).modal( 'hide' );
					break;
			}
		} );
		
		
		function AppUi ( app ) {
		var me = this;
		this.app = app;
		app.global.isPersonalMode( function ( reply ) {
			me.isPersonalMode = reply.qReturn;
		} );
		app.getAppLayout( function ( layout ) {
			$( "#title" ).html("Last reload:" + layout.qLastReloadTime.replace( /T/, ' ' ).replace( /Z/, ' ' ) );
			//$( "#title" ).attr( );
			//TODO: bootstrap tooltip ??
		} );
		
		}
		
		if ( app ) {
		new AppUi( app );
	}
	
	
	
	
	
	
	
	
	
});
		</script>

	
	


</body>
</html>
